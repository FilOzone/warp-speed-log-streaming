# Curio PDP - Better Stack Log Streaming Configuration
# Source: https://github.com/FilOzone/warp-speed-log-streaming/blob/main/vector.yaml
# Auto-configured by warp-speed-log-streaming installer

sources:
  curio_logs:
    type: "file"
    read_from: "end"
    include: ["/var/log/curio/curio.log"]

  curio_version_heartbeat:
    type: "exec"
    mode: "scheduled"
    command: ["sh", "-c", "curio --version 2>/dev/null"]
    scheduled:
      exec_interval_secs: 300  # Every 5 minutes

transforms:
  curio_parser:
    type: "remap"
    inputs: ["curio_logs"]
    source: |
      .client_id = "YOUR_CLIENT_ID"
      del(.source_type)
      del(.host)
      del(.file)

      # Parse JSON from message field
      parsed, err = parse_json(.message)
      if err == null {
        . = merge!(., parsed)
      }

      # Set dt from ts field or timestamp
      if exists(.ts) {
        .dt = .ts
      } else {
        .dt = del(.timestamp)
      }

      .platform = "Curio PDP"

  version_parser:
    type: "remap"
    inputs: ["curio_version_heartbeat"]
    source: |
      .client_id = "YOUR_CLIENT_ID"
      .platform = "Curio PDP"
      .curio_version = string!(.message)
      .dt = now()
      del(.host)
      del(.source_type)

sinks:
  better_stack_logs:
    type: "http"
    method: "post"
    uri: "https://s1560290.eu-nbg-2.betterstackdata.com/"
    encoding:
      codec: "json"
    compression: "gzip"
    auth:
      strategy: "bearer"
      token: "YOUR_BETTER_STACK_TOKEN"
    inputs: ["curio_parser", "version_parser"]
    batch:
      max_events: 100
      timeout_secs: 1
